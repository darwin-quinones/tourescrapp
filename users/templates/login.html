{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Login</title>
</head>

<body>
    <br><br>
   

    <main>

        <div class="contenedor__todo">

            <div class="caja__trasera">

                <div class="caja__trasera-login">
                    <h3>¿Ya tienes una cuenta?</h3>
                    <p>Inicia sesion para entrar a la pagina</p>
                    <button id="btn__iniciar-sesion">Iniciar sesion</button>
                </div>
                <div class="caja__trasera-register">
                    <h3>¿Aun no tienes una cuenta?</h3>
                    <p>Registrate para que puedas iniciar sesion</p>
                    <button id="btn__registrarse">Registrarse</button>
                </div>
            </div>

            <!--=====FORMULARIO DE LOGIN Y REGGISTRO DE USUARIOS=====-->
            <div class="contenedor__login-register">
                <!--===== LOGIN =====-->
                
                <form action="{% url 'login' %}" class="formulario__login" method="POST">{% csrf_token %}
                    {% if messages %}
                        {% for message in messages %}
                            {% if message.tags == 'error' %}
                                <div {% if message.tags %} class="alert alert-danger alert-dismissible fade show"{% endif %} role="alert">
                                    <strong>{{message}}</strong>
                                </div>
                            {% else %}
                                <div {% if message.tags %} class="alert alert-{{ message.tags }} alert-dismissible fade show"{% endif %} role="alert">
                                    <strong>{{message}}</strong>
                                </div>
                            {% endif %}
                            
                        {% endfor %}
                    {% endif%}

                    <h2>Iniciar Sesion</h2>
                    <input name="email" type="email" placeholder="Ingresar Correo" required>
                    <input type="password" name="password" placeholder="Ingresar contraseña" required>
                    <div class="row  justify-content-center">
                        <button class="col-7"type="submit">Ingresar</button>
                    </div>
                    
                </form>

       


                <!--===== REGISTRO DE USUARIOS =====-->
                <form class="formulario__register" style="width:800px;" method="POST">{% csrf_token %}
                    <H2>Registrarse</H2>
                    <div class="container">
                        <div class="row">
                            <div class="col-4 pb-4">
                                <label class="form-label">Nombres</label>
                                <input type="text" name="" id="nombres" placeholder="Nombres" required>
                            </div>
                            <div class="col-4">
                                <label class="form-label">Apellidos</label>
                                <input type="text" name="" id="apellidos" placeholder="Apellidos" required>
                            </div>
                            <div class="col-4">
                                <label class="form-label">Email</label>
                                <input type="email" name="" id="email" placeholder="username@gmail.com" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                <label class="form-label">Género</label>
                                <select name="" id="genero" class="form-select" aria-label="Default select example" required>
                                    <option selected>Selecciona...</option>
                                    <option value="M">Masculino</option>
                                    <option value="F">Femenino</option>
                                    <option value="O">Otro</option>
                                </select>
                            </div>
                            <div class="col-4">
                                <label class="form-label">Tipo Identificación</label>
                                <select name="" id="tipo_identificacion" class="form-select" aria-label="Default select example" required>
                                    <option selected>Selecciona...</option>
                                    <option value="CC">Cédula</option>
                                    <option value="TI">T. Identidad</option>
                                    <option value="O">Otro</option>
                                </select>
                            </div>
                            <div class="col-4">
                                <label class="form-label">Identificación</label>
                                <input type="number" name="" id="identificacion" placeholder="Identificación" required>
                            </div>
                        </div>
                        <div class="row">
                           
                            <div class="col-4">
                                <label class="form-label">Fecha nacimiento</label>
                                <input type="date" name="" id="fecha_naci" placeholder="Fecha nacimiento" required>
                            </div>
                            <div class="col-4">
                                <label class="form-label">Télefono</label>
                                <input type="number" name="" id="telefono" placeholder="Télefono" required>
                            </div>
                            <div class="col-4">
                                <label class="form-label">Lugar de recidencia</label>
                                <input type="text" name="" id="lugar_reci" placeholder="Recidencia" required>
                            </div>
                        </div>
                        <div class="row">
                            
                            <div class="col-4">
                                <label class="form-label">Nombre de usuario</label>
                                <input type="text" name="" id="username" placeholder="@username" required>
                            </div>
                            <div class="col-4">
                                <label class="form-label">Contraseña</label>
                                <input type="password" name="" id="password" placeholder="*********" required>
                            </div>
                            <div class="col-4">
                                <label class="form-label">Confirmar Contraseña</label>
                                <input type="password" name="" id="conf_password" placeholder="Confirmar Contraseña" required>
                            </div>
                            
                        </div>
                       
                    </div>



                    <!-- <input type="email" name="email" id="email" placeholder="Correo Electronico" required>
                    <input type="password" name="password" id="password" placeholder="Contraseña" required> -->
                   <center> <button type="button" id="Regristrar">Registrarse</button></center>
                </form>

                         
            </div>
        </div>
    </main>
    <script type="application/javascript" src="{% static 'js/home.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/script.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</body>
</html>
<script type="text/javascript">
    $(document).ready(function(){
        $('#Regristrar').click(function(){
            signUp()
        })
        function signUp(){
            
            let nombres = $('#nombres').val().trim()
            let apellidos = $('#apellidos').val().trim()
            let email = $('#email').val().trim()
            let genero = $('#genero').val()
            let tipo_identificacion = $('#tipo_identificacion').val()
            let identificacion = $('#identificacion').val()
            let fecha_naci = $('#fecha_naci').val()
            let telefono = $('#telefono').val()
            let lugar_reci = $('#lugar_reci').val()
            let username = $('#username').val().trim()
            let password = $('#password').val().trim()
            let conf_password = $('#conf_password').val().trim()
            console.log(genero, tipo_identificacion)
            if(nombres === "" || apellidos === "" || email === "" || genero === "Selecciona..." || tipo_identificacion === "Selecciona..." || identificacion === ""|| telefono === "" || lugar_reci ==="" || fecha_naci === "" ||  password === "" || conf_password === ""  ||username ==="" ){
                alert('Llene todos los campos')
            }else if(password != conf_password){
                alert('las contraseñas no coinciden')
            }else{
                data = {
                    nombres: nombres,
                    apellidos: apellidos,
                    email: email,
                    genero: genero,
                    tipo_identificacion: tipo_identificacion,
                    identificacion: identificacion,
                    fecha_naci: fecha_naci,
                    telefono: telefono,
                    lugar_reci: lugar_reci,
                    username: username,
                    password: password,
                }
                $.ajax({
                  
                    headers: {
                        'Content-Type':'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    url: "{% url 'sign_up' %}",
                    type: 'POST',
                    data: JSON.stringify(data),
                    success: function(response){
                        alert('usuario creado')
                        location.reload();
                    },
                    error: function(){
                        alert('hubo un error')
                    }
                })
            }
           

            /* Funcion de configuracion de django-jquery */
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        }
        
    })
</script>